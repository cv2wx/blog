"use strict";class Util{forEach(a,b){a=a||[];for(let c=0;c<a.length;c++)null!=a[c]&&b(a[c])}getScrollTop(){return document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}isMobile(){return window.matchMedia("only screen and (max-width: 680px)").matches}isTocStatic(){return window.matchMedia("only screen and (max-width: 960px)").matches}}class Theme{constructor(){this.config=window.config,this.data=this.config.data,this.isDark="dark"===document.body.getAttribute("theme"),this.util=new Util,this.newScrollTop=this.util.getScrollTop(),this.oldScrollTop=this.newScrollTop,this.scrollEventSet=new Set,this.resizeEventSet=new Set,this.switchThemeEventSet=new Set,this.clickMaskEventSet=new Set,this.menuToggleMobileEventListener=!1,window.objectFitImages&&objectFitImages()}initMenuMobile(){const a=document.getElementById("menu-toggle-mobile"),b=document.getElementById("menu-mobile");// If no event listener has been registered yet, add one.
// Remove the mask when click on it.
this.menuToggleMobileEventListener||(a.addEventListener("click",()=>{document.body.classList.toggle("blur"),a.classList.toggle("active"),b.classList.toggle("active")}),this.menuToggleMobileEventListener=!0),this._menuMobileOnClickMask=()=>{a.classList.remove("active"),b.classList.remove("active")},this.clickMaskEventSet.add(this._menuMobileOnClickMask)}initSwitchTheme(){this.util.forEach(document.getElementsByClassName("theme-switch"),a=>{a.addEventListener("click",()=>{"dark"===document.body.getAttribute("theme")?document.body.setAttribute("theme","light"):document.body.setAttribute("theme","dark"),this.isDark=!this.isDark,window.localStorage&&localStorage.setItem("theme",this.isDark?"dark":"light");for(let a of this.switchThemeEventSet)a()},!1)})}initSearch(){const a=this.config.search,b=this.util.isMobile();if(!a||b&&this._searchMobileOnce||!b&&this._searchDesktopOnce)return;// Initialize default search config
const c=a.maxResultLength?a.maxResultLength:10,d=a.highlightTag?a.highlightTag:"em",e=!!a.isCaseSensitive&&a.isCaseSensitive,f=a.minMatchCharLength?a.minMatchCharLength:1,g=!!a.findAllMatches&&a.findAllMatches,h=a.location?a.location:0,i=a.threshold?a.threshold:.3,j=a.distance?a.distance:100,k=!!a.ignoreLocation&&a.ignoreLocation,l=!!a.useExtendedSearch&&a.useExtendedSearch,m=!!a.ignoreFieldNorm&&a.ignoreFieldNorm,n=b?"mobile":"desktop",o=document.getElementById(`header-${n}`),p=document.getElementById(`search-input-${n}`),q=document.getElementById(`search-toggle-${n}`),r=document.getElementById(`search-loading-${n}`),s=document.getElementById(`search-clear-${n}`);b?(this._searchMobileOnce=!0,p.addEventListener("focus",()=>{document.body.classList.add("blur"),o.classList.add("open"),console.log("focus")}),document.getElementById("search-cancel-mobile").addEventListener("click",()=>{o.classList.remove("open"),document.body.classList.remove("blur"),document.getElementById("menu-toggle-mobile").classList.remove("active"),document.getElementById("menu-mobile").classList.remove("active"),r.style.display="none",s.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")}),s.addEventListener("click",()=>{s.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},!1),this._searchMobileOnClickMask=()=>{o.classList.remove("open"),r.style.display="none",s.style.display="none",this._searchMobile&&this._searchMobile.autocomplete.setVal("")},this.clickMaskEventSet.add(this._searchMobileOnClickMask)):(this._searchDesktopOnce=!0,q.addEventListener("click",()=>{document.body.classList.add("blur"),o.classList.add("open"),p.focus()}),s.addEventListener("click",()=>{s.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")}),document.addEventListener("keydown",a=>{a.ctrlKey&&"KeyK"===a.code&&(a.preventDefault(),q.click())}),this._searchDesktopOnClickMask=()=>{o.classList.remove("open"),r.style.display="none",s.style.display="none",this._searchDesktop&&this._searchDesktop.autocomplete.setVal("")},this.clickMaskEventSet.add(this._searchDesktopOnClickMask)),p.addEventListener("input",()=>{s.style.display=""===p.value?"none":"inline"});const t=()=>{const o=autocomplete(`#search-input-${n}`,{hint:!1,autoselect:!0,dropdownMenuContainer:`#search-dropdown-${n}`,clearOnSelected:!0,cssClasses:{noPrefix:!0},debug:!1},{name:"search",source:(b,n)=>{r.style.display="inline",s.style.display="none";const o=a=>{r.style.display="none",s.style.display="inline",n(a)},p=()=>{const a={};return window._index.search(b).forEach(b=>{let{item:c,refIndex:e,matches:f}=b,g=c.title,h=c.content;f.forEach(a=>{let{indices:b,value:c,key:e}=a;if("content"===e){let a=0;for(let c=0;c<b.length;c++){const e=h.substring(b[c][0]+a,b[c][1]+1+a);h=h.substring(0,b[c][0]+a)+(`<${d}>`+e+`</${d}>`)+h.substring(b[c][1]+1+a,h.length),a+=2*d.length+5}}else if("title"===e){let a=0;for(let c=0;c<b.length;c++){const e=g.substring(b[c][0]+a,b[c][1]+1+a);g=g.substring(0,b[c][0]+a)+(`<${d}>`+e+`</${d}>`)+g.substring(b[c][1]+1+a,h.length),a+=2*d.length+5}}}),a[c.uri]={uri:c.uri,title:g,date:c.date,context:h}}),Object.values(a).slice(0,c)};window._index?o(p()):fetch(a.fuseIndexURL).then(a=>a.json()).then(a=>{window._index=new Fuse(a,{isCaseSensitive:e,findAllMatches:g,minMatchCharLength:f,location:h,threshold:i,distance:j,ignoreLocation:k,useExtendedSearch:l,ignoreFieldNorm:m,includeScore:!1,shouldSort:!0,includeMatches:!0,keys:["content","title"]}),o(p())}).catch(a=>{console.error(a),o([])})},templates:{suggestion:a=>{let{title:b,date:c,context:d}=a;return`<div><span class="suggestion-title">${b}</span><span class="suggestion-date">${c}</span></div><div class="suggestion-context">${d}</div>`},empty:b=>{let{query:c}=b;return`<div class="search-empty">${a.noResultsFound}: <span class="search-query">"${c}"</span></div>`},footer:()=>{const{searchType:a,icon:b,href:c}={searchType:"Fuse.js",icon:"",href:"https://fusejs.io/"};return`<div class="search-footer">Search by <a href="${c}" rel="noopener noreffer" target="_blank">${b} ${a}</a></div>`}}});o.on("autocomplete:selected",(a,b)=>{window.location.assign(b.uri)}),b?this._searchMobile=o:this._searchDesktop=o};t()}initDetails(){this.util.forEach(document.getElementsByClassName("details"),a=>{const b=a.getElementsByClassName("details-summary")[0];b.addEventListener("click",()=>{a.classList.toggle("open")},!1)})}initLightGallery(){this.config.lightGallery&&lightGallery(document.getElementById("content"),this.config.lightGallery)}initHighlight(){this.util.forEach(document.querySelectorAll(".highlight > pre.chroma"),a=>{const b=document.createElement("div");b.className=a.className;const c=document.createElement("table");b.appendChild(c);const d=document.createElement("tbody");c.appendChild(d);const e=document.createElement("tr");d.appendChild(e);const f=document.createElement("td");e.appendChild(f),a.parentElement.replaceChild(b,a),f.appendChild(a)}),this.util.forEach(document.querySelectorAll(".highlight > .chroma"),a=>{const b=a.querySelectorAll("pre.chroma > code");if(b.length){const c=b[b.length-1],d=document.createElement("div");d.className="code-header "+c.className.toLowerCase();const e=document.createElement("span");e.classList.add("code-title"),e.insertAdjacentHTML("afterbegin","<i class=\"icon-angle-circled-right\"></i>"),e.addEventListener("click",()=>{a.classList.toggle("open")},!1),d.appendChild(e);const f=document.createElement("span");f.insertAdjacentHTML("afterbegin","<i class=\"icon-ellipsis\"></i>"),f.classList.add("ellipses"),f.addEventListener("click",()=>{a.classList.add("open")},!1),d.appendChild(f);const g=document.createElement("span");g.insertAdjacentHTML("afterbegin","<i class=\"icon-copy\"></i>"),g.classList.add("copy");const h=c.innerText;if((0>this.config.code.maxShownLines||h.split("\n").length<this.config.code.maxShownLines+2)&&a.classList.add("open"),this.config.code.copyTitle){g.setAttribute("data-clipboard-text",h),g.title=this.config.code.copyTitle;new ClipboardJS(g);d.appendChild(g)}a.insertBefore(d,a.firstChild)}})}initToc(){const a=document.getElementById("TableOfContents");if(null!==a)if(document.getElementById("toc-static").getAttribute("kept")||this.util.isTocStatic()){const b=document.getElementById("toc-content-static");a.parentElement!==b&&(a.parentElement.removeChild(a),b.appendChild(a)),this._tocOnScroll&&this.scrollEventSet.delete(this._tocOnScroll)}else{const b=document.getElementById("toc-content-auto");a.parentElement!==b&&(a.parentElement.removeChild(a),b.appendChild(a));const c=document.getElementById("toc-auto"),d=document.getElementsByClassName("page")[0],e=d.getBoundingClientRect();c.style.left=`${e.left+e.width+20}px`,c.style.maxWidth=`${d.getBoundingClientRect().left-10}px`,c.style.visibility="visible";const f=a.querySelectorAll("a:first-child"),g=a.getElementsByTagName("li"),h=document.getElementsByClassName("headerLink"),i="normal"!==document.body.getAttribute("header-desktop"),j=document.getElementById("header-desktop").offsetHeight,k=20+(i?j:0),l=c.offsetTop,m=l-k+(i?0:j);this._tocOnScroll=this._tocOnScroll||(()=>{const b=document.getElementById("post-footer").offsetTop,d=b-c.getBoundingClientRect().height,e=d-k+(i?0:j);this.newScrollTop<m?(c.style.position="absolute",c.style.top=`${l}px`):this.newScrollTop>e?(c.style.position="absolute",c.style.top=`${d}px`):(c.style.position="fixed",c.style.top=`${k}px`),this.util.forEach(f,a=>{a.classList.remove("active")}),this.util.forEach(g,a=>{a.classList.remove("has-active")});const n=20+(i?j:0);let o=h.length-1;for(let a=0;a<h.length-1;a++){const b=h[a].getBoundingClientRect().top,c=h[a+1].getBoundingClientRect().top;if(0==a&&b>n||b<=n&&c>n){o=a;break}}if(-1!==o){f[o].classList.add("active");for(let b=f[o].parentElement;b!==a;)b.classList.add("has-active"),b=b.parentElement.parentElement}}),this._tocOnScroll(),this.scrollEventSet.add(this._tocOnScroll)}}initMermaid(){const a=document.getElementsByClassName("mermaid");a.length&&(mermaid.initialize({startOnLoad:!1,theme:"null"}),this.util.forEach(a,a=>{mermaid.mermaidAPI.render("svg-"+a.id,this.data[a.id],b=>{a.insertAdjacentHTML("afterbegin",b)},a)}))}initComment(){if(this.config.comment&&this.config.comment.giscus){const a=this.config.comment.giscus,b=document.createElement("script");b.src="https://giscus.app/client.js",b.type="text/javascript",b.setAttribute("data-repo",a.repo),b.setAttribute("data-repo-id",a.repoid),b.setAttribute("data-category",a.category),b.setAttribute("data-category-id",a.categoryid),b.setAttribute("data-mapping",a.mapping),b.setAttribute("data-reactions-enabled","1"),b.setAttribute("data-emit-metadata","0"),b.setAttribute("data-lang","zh-CN"),b.setAttribute("data-theme",this.isDark?"dark":"light"),b.crossOrigin="anonymous",b.async=!0,document.getElementById("giscus").appendChild(b),this._giscusOnSwitchTheme=this._giscusOnSwitchTheme||(()=>{const a={setConfig:{theme:this.isDark?"dark":"light"}},b=document.querySelector("iframe.giscus-frame");b&&b.contentWindow.postMessage({giscus:a},"https://giscus.app")}),this.switchThemeEventSet.add(this._giscusOnSwitchTheme)}}initSmoothScroll(){SmoothScroll&&new SmoothScroll("[href^=\"#\"]",{speed:300,speedAsDuration:!0,header:"#header-desktop"})}onScroll(){const a=[];if("auto"===document.body.getAttribute("header-desktop")&&a.push(document.getElementById("header-desktop")),"auto"===document.body.getAttribute("header-mobile")&&a.push(document.getElementById("header-mobile")),document.getElementById("comments")){const a=document.getElementById("view-comments");a.href=`#comments`,a.style.display="block"}const b=document.getElementById("fixed-buttons"),c=20;window.addEventListener("scroll",()=>{this.newScrollTop=this.util.getScrollTop();const d=this.newScrollTop-this.oldScrollTop,e=this.util.isMobile();this.util.forEach(a,a=>{d>c?a.classList.remove("fadeInDown"):d<-c&&a.classList.remove("fadeOutUp")}),this.newScrollTop>100?e&&d>c?b.classList.remove("fadeIn"):(!e||d<-c)&&(b.style.display="block",b.classList.remove("fadeOut")):(!e&&b.classList.remove("fadeIn"),b.style.display="none");for(let a of this.scrollEventSet)a();this.oldScrollTop=this.newScrollTop},!1)}onResize(){window.addEventListener("resize",()=>{this._resizeTimeout||(this._resizeTimeout=window.setTimeout(()=>{this._resizeTimeout=null;for(let a of this.resizeEventSet)a();this.initToc(),this.initMermaid(),this.initSearch()},100))},!1)}onClickMask(){document.getElementById("mask").addEventListener("click",()=>{for(let a of this.clickMaskEventSet)a();document.body.classList.remove("blur")},!1)}removeElementsByClass(a){for(const b=document.getElementsByClassName(a);0<b.length;)b[0].parentNode.removeChild(b[0])}checkMobile(){this.util.isMobile()?(this.removeElementsByClass("desktop"),this.initMenuMobile()):this.removeElementsByClass("mobile")}init(){try{this.checkMobile(),this.initSwitchTheme()}catch(a){console.error(a)}window.setTimeout(()=>{this.initHighlight(),this.initDetails(),this.initSmoothScroll(),this.initToc(),this.onScroll(),this.onResize(),this.onClickMask()},100),window.setTimeout(()=>{this.initSearch(),this.initMermaid(),this.initLightGallery()},500),window.setTimeout(()=>{this.initComment()},1e3)}}const themeInit=()=>{const a=new Theme;a.init()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",themeInit,!1):themeInit();

//# sourceMappingURL=theme.min.js.map